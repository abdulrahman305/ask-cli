namespace com.dialogTen

import com.amazon.alexa.ask.conversations.*
import com.amazon.alexa.schema.*
import com.amazon.ask.types.builtins.AMAZON.*
import prompts.*
import slotTypes.*

// API Action

action Nothing saveRating(Number rating)

action Number getNumber()

// UtteraceSets 

InformRatingEvent = utterances<RatingRequest>(
  samples = [
    "my score is {rating}",
    "that was a {rating} conversation",
    "i rate you a {rating}",
    "{rating}"
  ]
)

getStart = utterances(
  samples = [
    "give me a number please"
  ]
)

// Type

type NumPayload {
  Number num
}

type RatingRequest {
  NUMBER rating
}


dialog Nothing dialogTen() {

  sample {
    expect(act = Invoke, event = getStart)
    num = getNumber()
    response(response = numericfeedback_apla, act = Notify {actionName = getNumber, success = true},
      nextAct = Offer { actionName = saveRating, arguments = [saveRating.arguments.rating]}, 
      payload = NumPayload {num = num})
    myRating = expect( act = Invoke,event = InformRatingEvent)
    ensure(requestArgs = [RequestArguments<Thing> {arguments = [saveRating.arguments.rating],
      response = rating_apla}])
    saveRating(rating = myRating.rating)
    response(response = AlexaConversationsBye, act = Notify { actionName = saveRating,success = true}, 
      nextAct = Bye {})
  }

}
